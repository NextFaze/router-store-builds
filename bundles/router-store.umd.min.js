!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@angular/router"),require("@ngrx/store"),require("rxjs/observable/of")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/router","@ngrx/store","rxjs/observable/of"],factory):factory((global.ngrx=global.ngrx||{},global.ngrx.routerStore=global.ngrx.routerStore||{}),global.ng.core,global.ng.router,global.ngrx.store,global.Rx.Observable)}(this,function(exports,_angular_core,_angular_router,_ngrx_store,rxjs_observable_of){"use strict";function routerReducer(state,action){switch(action.type){case ROUTER_NAVIGATION:case ROUTER_ERROR:case ROUTER_CANCEL:return{state:action.payload.routerState,navigationId:action.payload.event.id};default:return state}}var ROUTER_NAVIGATION="ROUTER_NAVIGATION",ROUTER_CANCEL="ROUTER_CANCEL",ROUTER_ERROR="ROUTE_ERROR",StoreRouterConnectingModule=function(){function StoreRouterConnectingModule(store,router){this.store=store,this.router=router,this.routerState=null,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1,this.setUpBeforePreactivationHook(),this.setUpStoreStateListener(),this.setUpStateRollbackEvents()}return StoreRouterConnectingModule.prototype.setUpBeforePreactivationHook=function(){var _this=this;this.router.hooks.beforePreactivation=function(routerState){return _this.routerState=routerState,_this.shouldDispatch()&&_this.dispatchEvent(),rxjs_observable_of.of(!0)}},StoreRouterConnectingModule.prototype.setUpStoreStateListener=function(){var _this=this;this.store.subscribe(function(s){_this.storeState=s,_this.navigateIfNeeded()})},StoreRouterConnectingModule.prototype.dispatchEvent=function(){this.dispatchTriggeredByRouter=!0;try{var payload={routerState:this.routerState,event:this.lastRoutesRecognized};this.store.dispatch({type:ROUTER_NAVIGATION,payload:payload})}finally{this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}},StoreRouterConnectingModule.prototype.shouldDispatch=function(){return!this.storeState.routerReducer||!this.navigationTriggeredByDispatch},StoreRouterConnectingModule.prototype.navigateIfNeeded=function(){this.storeState.routerReducer&&(this.dispatchTriggeredByRouter||this.router.url!==this.storeState.routerReducer.state.url&&(this.navigationTriggeredByDispatch=!0,this.router.navigateByUrl(this.storeState.routerReducer.state.url)))},StoreRouterConnectingModule.prototype.setUpStateRollbackEvents=function(){var _this=this;this.router.events.subscribe(function(e){e instanceof _angular_router.RoutesRecognized?_this.lastRoutesRecognized=e:e instanceof _angular_router.NavigationCancel?_this.dispatchRouterCancel(e):e instanceof _angular_router.NavigationError&&_this.dispatchRouterError(e)})},StoreRouterConnectingModule.prototype.dispatchRouterCancel=function(event){var payload={routerState:this.routerState,storeState:this.storeState,event:event};this.store.dispatch({type:ROUTER_CANCEL,payload:payload})},StoreRouterConnectingModule.prototype.dispatchRouterError=function(event){var payload={routerState:this.routerState,storeState:this.storeState,event:event};this.store.dispatch({type:ROUTER_ERROR,payload:payload})},StoreRouterConnectingModule}();StoreRouterConnectingModule.decorators=[{type:_angular_core.NgModule,args:[{}]}],StoreRouterConnectingModule.ctorParameters=function(){return[{type:_ngrx_store.Store},{type:_angular_router.Router}]},exports.ROUTER_ERROR=ROUTER_ERROR,exports.ROUTER_CANCEL=ROUTER_CANCEL,exports.ROUTER_NAVIGATION=ROUTER_NAVIGATION,exports.routerReducer=routerReducer,exports.StoreRouterConnectingModule=StoreRouterConnectingModule,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/router-store/bundles/router-store.umd.min.js.map