!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/router"),require("@ngrx/store"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngrx/router-store",["exports","@angular/core","@angular/router","@ngrx/store","rxjs"],e):e((t.ngrx=t.ngrx||{},t.ngrx.routerStore={}),t.ng.core,t.ng.router,t.ngrx.store,t.Rx)}(this,function(t,e,r,o,i){"use strict";var a=function(){},n=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map(function(t){return e.serializeRoute(t)});return{params:t.params,paramMap:t.paramMap,data:t.data,url:t.url,outlet:t.outlet,routeConfig:{component:t.routeConfig?t.routeConfig.component:void 0},queryParams:t.queryParams,queryParamMap:t.queryParamMap,fragment:t.fragment,component:t.routeConfig?t.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:r[0],pathFromRoot:void 0,children:r}},t}(),s="ROUTER_NAVIGATION",u="ROUTER_CANCEL",c="ROUTE_ERROR";var p=new e.InjectionToken("@ngrx/router-store Internal Configuration"),d=new e.InjectionToken("@ngrx/router-store Configuration"),h="routerReducer";function g(t){var e;return e="function"==typeof t?t():t||{},Object.assign({stateKey:h},e)}var R={stateKey:h},f=function(){function e(t,e,r,o){this.store=t,this.router=e,this.serializer=r,this.config=o,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1,this.stateKey=this.config.stateKey,this.setUpBeforePreactivationHook(),this.setUpStoreStateListener(),this.setUpStateRollbackEvents()}return e.forRoot=function(t){return void 0===t&&(t={}),{ngModule:e,providers:[{provide:p,useValue:t},{provide:d,useFactory:g,deps:[p]}]}},e.prototype.setUpBeforePreactivationHook=function(){var e=this;this.router.hooks.beforePreactivation=function(t){return e.routerState=e.serializer.serialize(t),e.shouldDispatchRouterNavigation()&&e.dispatchRouterNavigation(),i.of(!0)}},e.prototype.setUpStoreStateListener=function(){var e=this;this.store.subscribe(function(t){e.storeState=t}),this.store.pipe(o.select(this.stateKey)).subscribe(function(){e.navigateIfNeeded()})},e.prototype.shouldDispatchRouterNavigation=function(){return!this.storeState[this.stateKey]||!this.navigationTriggeredByDispatch},e.prototype.navigateIfNeeded=function(){this.storeState[this.stateKey]&&this.storeState[this.stateKey].state&&(this.dispatchTriggeredByRouter||this.router.url!==this.storeState[this.stateKey].state.url&&(this.navigationTriggeredByDispatch=!0,this.router.navigateByUrl(this.storeState[this.stateKey].state.url)))},e.prototype.setUpStateRollbackEvents=function(){var e=this;this.router.events.subscribe(function(t){t instanceof r.RoutesRecognized?e.lastRoutesRecognized=t:t instanceof r.NavigationCancel?e.dispatchRouterCancel(t):t instanceof r.NavigationError?e.dispatchRouterError(t):t instanceof r.NavigationEnd&&(e.dispatchTriggeredByRouter=!1,e.navigationTriggeredByDispatch=!1)})},e.prototype.dispatchRouterNavigation=function(){this.dispatchRouterAction(s,{routerState:this.routerState,event:new r.RoutesRecognized(this.lastRoutesRecognized.id,this.lastRoutesRecognized.url,this.lastRoutesRecognized.urlAfterRedirects,this.routerState)})},e.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction(u,{routerState:this.routerState,storeState:this.storeState,event:t})},e.prototype.dispatchRouterError=function(t){this.dispatchRouterAction(c,{routerState:this.routerState,storeState:this.storeState,event:new r.NavigationError(t.id,t.url,""+t)})},e.prototype.dispatchRouterAction=function(t,e){this.dispatchTriggeredByRouter=!0;try{this.store.dispatch({type:t,payload:e})}finally{this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}},e}();f.decorators=[{type:e.NgModule,args:[{providers:[{provide:a,useClass:n},{provide:p,useValue:R},{provide:d,useFactory:g,deps:[p]}]}]}],f.ctorParameters=function(){return[{type:o.Store},{type:r.Router},{type:a},{type:void 0,decorators:[{type:e.Inject,args:[d]}]}]},t.ROUTER_ERROR=c,t.ROUTER_CANCEL=u,t.ROUTER_NAVIGATION=s,t.routerReducer=function(t,e){switch(e.type){case s:case c:case u:return{state:e.payload.routerState,navigationId:e.payload.event.id};default:return t}},t.StoreRouterConnectingModule=f,t.ROUTER_CONFIG=d,t.DEFAULT_ROUTER_FEATURENAME=h,t.RouterStateSerializer=a,t.DefaultRouterStateSerializer=n,t.ɵa=p,t.ɵb=g,Object.defineProperty(t,"__esModule",{value:!0})});